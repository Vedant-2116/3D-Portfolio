var p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",w=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/;function S(e){e=String(e);for(var t,o,s,i,r="",a=0,d=e.length%3;a<e.length;){if((o=e.charCodeAt(a++))>255||(s=e.charCodeAt(a++))>255||(i=e.charCodeAt(a++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");t=o<<16|s<<8|i,r+=p.charAt(t>>18&63)+p.charAt(t>>12&63)+p.charAt(t>>6&63)+p.charAt(t&63)}return d?r.slice(0,d-3)+"===".substring(d):r}function g(e){if(e=String(e).replace(/[\t\n\f\r ]+/g,""),!w.test(e))throw new TypeError("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");e+="==".slice(2-(e.length&3));for(var t,o="",s,i,r=0;r<e.length;)t=p.indexOf(e.charAt(r++))<<18|p.indexOf(e.charAt(r++))<<12|(s=p.indexOf(e.charAt(r++)))<<6|(i=p.indexOf(e.charAt(r++))),o+=s===64?String.fromCharCode(t>>16&255):i===64?String.fromCharCode(t>>16&255,t>>8&255):String.fromCharCode(t>>16&255,t>>8&255,t&255);return o}var R="2.8.1";var I=(r=>(r.REQUIRED_FIELD_MISSING="REQUIRED_FIELD_MISSING",r.REQUIRED_FIELD_EMPTY="REQUIRED_FIELD_EMPTY",r.TYPE_EMAIL="TYPE_EMAIL",r.TYPE_NUMERIC="TYPE_NUMERIC",r.TYPE_TEXT="TYPE_TEXT",r))(I||{});function A(e){return e.code in I&&e.field!==void 0}function _(e){return e.errors!==void 0}var x=e=>S(JSON.stringify(e));var T=e=>{let t=`@formspree/core@${R}`;return e?`${e} ${t}`:t},O=()=>1*new Date,u=(e,t,o)=>{e instanceof FormData?e.append(t,o):e=Object.assign(e,{[t]:o})},C=async({stripePromise:e,response:t,responseData:o,payload:s,data:i,fetchImpl:r,request:a,url:d})=>{let c=await e.handleCardAction(o.stripe.paymentIntentClientSecret);if(c.error)return{response:t,body:{errors:[{code:"STRIPE_CLIENT_ERROR",message:"Stripe SCA error",field:"paymentMethod"}]}};{s.paymentMethod.id||u(i,"paymentMethod",s.paymentMethod.id),u(i,"paymentIntent",c.paymentIntent.id),u(i,"resubmitKey",o.resubmitKey);let m=await r(d,{...a,body:JSON.stringify({paymentIntent:c.paymentIntent.id,resubmitKey:o.resubmitKey})}),n=await m.json();return{response:m,body:n}}};function b({body:e,response:t}){return!_(e)&&(e==null?void 0:e.error)&&(e={errors:[{message:e.error}]}),{body:e,response:t}}var D=()=>navigator.webdriver||!!document.documentElement.getAttribute(g("d2ViZHJpdmVy"))||!!window.callPhantom||!!window._phantom,y=class{constructor(){this.loadedAt=O(),this.webdriver=D()}teardown(){}data(){return{loadedAt:this.loadedAt,webdriver:this.webdriver}}};var h=class{constructor(t={}){this.project=t.project,this.stripePromise=t.stripePromise,typeof window<"u"&&this.startBrowserSession()}startBrowserSession(){this.session||(this.session=new y)}teardown(){this.session&&this.session.teardown()}async submitForm(t,o,s={}){let i=s.endpoint||"https://formspree.io",r=s.fetchImpl||fetch,a=this.project?`${i}/p/${this.project}/f/${t}`:`${i}/f/${t}`,d=n=>n instanceof FormData?n:JSON.stringify(n),c={Accept:"application/json","Formspree-Client":T(s.clientName)};this.session&&(c["Formspree-Session-Data"]=x(this.session.data())),o instanceof FormData||(c["Content-Type"]="application/json");let m={method:"POST",mode:"cors",body:d(o),headers:c};if(this.stripePromise&&s.createPaymentMethod){let n=await s.createPaymentMethod();if(n.error)return{response:null,body:{errors:[{code:"STRIPE_CLIENT_ERROR",message:"Error creating payment method",field:"paymentMethod"}]}};u(o,"paymentMethod",n.paymentMethod.id);let f=await r(a,{...m,body:o}),l=await f.json();return l&&l.stripe&&l.stripe.requiresAction&&l.resubmitKey?await C({stripePromise:this.stripePromise,responseData:l,response:f,payload:n,data:o,fetchImpl:r,request:m,url:a}):b({response:f,body:l})}else return r(a,m).then(n=>n.json().then(f=>b({body:f,response:n}))).catch()}},P=e=>new h(e),j=()=>(E||(E=P()),E),E;export{h as Client,P as createClient,j as getDefaultClient,A as isFieldError};
